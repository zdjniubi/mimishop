<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>活动列表</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="css/mall.css">
	<style>
		body{
			background-color: #fff;
		}
	</style>
	<link href="static/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
	<link href="static/assets/global/css/components.css" rel="stylesheet" type="text/css"/>
	<link href="static/assets/admin/pages/css/login.css" rel="stylesheet" type="text/css"/>
	<script src="static/assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
	<script src="./gethost.js" type="text/javascript"></script>

</head>
<body>
<!-- 顶部导航条 -->
<div class="nav">
	<ul>
		<li class="nav-pull-down location">
			<img src="img/icon_location.png"> 送至哈尔滨</li>
		<li>
			<a href="#">手机商城</a>
		</li>
		<li>
			<a href="#">网站导航</a>
		</li>
		<li>
			<a href="help.html">客户服务</a>
		</li>
		<li>
			<a href="#">企业采购</a>
		</li>
		<li>
			<a href="index.html">首页</a>
		</li>
		<li class="nav-pull-down my-shop">
			<a href="#">我的商城</a>
			<span class="glyphicon glyphicon-menu-down"></span>
		</li>
		<li class="login-signup">你好，请
			<a href="login.html">登录 </a>
			<span class="text-color-red">
                    <a href="signup.html">免费注册</a>
                </span>
		</li>
	</ul>
</div>

<!-- 导航条 -->
<!-- 导航栏 -->
<div class="search-nav">
	<div class="search-nav-container search-nav-container-90">
		<ul>
			<li>全部商品分类</li>
			<li><a href="index.html">首页</a></li>
			<li><a href="index.html">服装城</a></li>
			<li><a href="index.html">美妆馆</a></li>
			<li><a href="index.html">京东超市</a></li>
			<li><a href="index.html">生鲜</a></li>
			<li><a href="index.html">全球购</a></li>
			<li><a href="index.html">闪购</a></li>
			<li><a href="index.html">拍卖</a></li>
			<li><a href="index.html">金融</a></li>
		</ul>
	</div>
</div>
<!-- 支付提示 -->
<div class="panel panel-default feedback-panel">
		<table class="table" id="tab">
			<thead>
			<tr>
				<th>活动名称</th>
				<th>商品id</th>
				<th>商品价格</th>
				<th>活动状态</th>
				<th>操作</th>
			</tr>
			</thead>
		</table>
</div>
<!-- 底部 -->
<footer class="footer">
	<div class="clearfix"></div>
	<div class="icon-row">
		<div class="footer-icon">
			<h5 class="footer-icon-child"></h5>
			<span class="footer-icon-text">品类齐全，轻松购物</span>
		</div>
		<div class="footer-icon">
			<h5 class="footer-icon-child footer-icon-child-2"></h5>
			<span class="footer-icon-text">多仓直发，极速配送</span>
		</div>
		<div class="footer-icon">
			<h5 class="footer-icon-child footer-icon-child-3"></h5>
			<span class="footer-icon-text">正品行货，精致服务</span>
		</div>
		<div class="footer-icon">
			<h5 class="footer-icon-child footer-icon-child-4"></h5>
			<span class="footer-icon-text">天天低价，畅选无忧</span>
		</div>
	</div>
	<div class="service-intro">
		<div class="servece-type">
			<div class="servece-type-info">
				<ul>
					<li>购物指南</li>
					<li>购物流程</li>
					<li>会员介绍</li>
					<li>生活旅行</li>
					<li>常见问题</li>
					<li>大家电</li>
					<li>联系客服</li>
				</ul>
			</div>
			<div class="servece-type-info">
				<ul>
					<li>配送方式</li>
					<li>上门自提</li>
					<li>211限时达</li>
					<li>配送服务查询</li>
					<li>配送费收取标准</li>
					<li>海外配送</li>
				</ul>
			</div>
			<div class="servece-type-info">
				<ul>
					<li>支付方式</li>
					<li>货到付款</li>
					<li>在线支付</li>
					<li>分期付款</li>
					<li>邮局汇款</li>
					<li>公司转账</li>
				</ul>
			</div>
			<div class="servece-type-info">
				<ul>
					<li>售后服务</li>
					<li>售后政策</li>
					<li>价格保护</li>
					<li>退款说明</li>
					<li>返修/退换货</li>
					<li>取消订单</li>
				</ul>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="friend-link">
			<div class="friend-link-item">
				<ul>
					<li><span class="link-item">关于我们</span></li>
					<li><span class="link-item">联系我们</span></li>
					<li><span class="link-item">联系客服</span></li>
					<li><span class="link-item">合作招商</span></li>
					<li><span class="link-item">商家帮助</span></li>
					<li><span class="link-item">营销中心</span></li>
					<li><span class="link-item">销售联盟</span></li>
					<li><span class="link-item">校园社区</span></li>
					<li><span class="link-item">风险监测</span></li>
					<li><span class="link-item link-last-item">隐私政策</span></li>
				</ul>
			</div>
		</div>
		<div class="clearfix"></div>
		<div class="copyright">
			<p>Copyright © 2017 BY Gavin MIMISHOP</p>
		</div>
	</div>
</footer>
</body>

<script>
	//定义全局商品数组信息
	var g_itemList = [];
	jQuery(document).ready(function(){
		$.ajax({
			type:"GET",
			contentType:"application/x-www-form-urlencoded",
			url:"http://"+g_host+"/item/getPromos",
			async : false,
			xhrFields:{withCredentials:true},
			success:function(data){
				if(data.status == "success"){
					g_itemList = data.data;
					reloadDom();
				}else{
					alert("获取活动信息失败，原因为"+data.data.errMsg);
				}
			},
			error:function(data){
				alert("获取活动信息失败，原因为"+data.responseText);
			}
		});
		$(".deletePromo").click(function () {
			var code = $(this).attr("code");
			$.ajax({
				type:"GET",
				contentType:"application/x-www-form-urlencoded",
				url:"http://"+g_host+"/item/deletePromo",
				data:{
					"id":code
				},
				xhrFields:{withCredentials:true},
				success:function(data){
					if(data.status == "success") {
						alert("下架成功")
						window.location.reload();
					}
				},
			});

	});
		$(".publishPromo").click(function () {
			var code = $(this).attr("code");

			$.ajax({
				type:"GET",
				contentType:"application/x-www-form-urlencoded",
				url:"http://"+g_host+"/item/publishpromo",
				data:{
					"id":code
				},
				xhrFields:{withCredentials:true},
				success:function(data){
					if(data.status == "success") {
						alert("重新发布成功")
						window.location.reload();
					}
				},
			});

		});
	});


	function reloadDom(){
		for(var i = 0; i < g_itemList.length; i++){
			var promoVo = g_itemList[i];
			var status
			var option
			if (promoVo.status == 1) {
				status = "未开始"

			}
			if (promoVo.status == 2) {
				status = "进行中"
				option = "下架"
			}
			if (promoVo.status == 3) {
				status = "已结束"
			}


			var dom =
					"<tr>"+
					"<td>"+promoVo.promoName+"</td>"+
					"<td>"+promoVo.itemId+"</td>"+
					"<td>"+promoVo.promoItemPrice+"</td>"+
					"<td>"+status+"</td>";
			if (promoVo.status == 2) {
				dom += "<td><button class='deletePromo btn btn-danger' id='delete' type='button' code='"+promoVo.id+"'>"+option+"</button></td>" +
						"<td><button class='publishPromo btn btn-danger' id='republish' type='button' code='"+promoVo.id+"'>重新上架</button></td></tr>"
			} else {
				dom += "</tr>"
			}

			$("#tab").append(dom);
			optionId = promoVo.id;
			$("#optionId").on("click",function() {
				alert(promoVo.promoName)
			})
		}

	}


</script>
</html>