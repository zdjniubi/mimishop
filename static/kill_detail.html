<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>砍价详情</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/car/bar.css">
    <link rel="stylesheet" href="css/car/base.css">
    <link rel="stylesheet" href="css/car/bottom.css">
    <link rel="stylesheet" href="css/car/item-list.css">
    <link rel="stylesheet" href="css/car/settlement.css">
    <link rel="stylesheet" href="css/car/top.css">
    <link rel="stylesheet" href="css/car/w.css">


    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/dropdown.js"></script>
    <link rel="stylesheet" href="css/mall.css">
    <style>
        body{
            background-color: #fff;
        }
    </style>
    <link href="static/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="static/assets/global/css/components.css" rel="stylesheet" type="text/css"/>
    <link href="static/assets/admin/pages/css/login.css" rel="stylesheet" type="text/css"/>
    <script src="static/assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="./gethost.js" type="text/javascript"></script>
</head>

<body>
<!-- 顶部导航条 -->
<!-- 顶部导航条 -->
<div class="nav">
    <ul>
        <li class="nav-pull-down location"><img src="img/icon_location.png"> 珠海</li>
        <li><a href="#">手机商城</a></li>
        <li><a href="#">网站导航</a></li>
        <li><a href="help.html">客户服务</a></li>
        <li><a href="#">企业采购</a></li>
        <li><a href="index.html">首页</a></li>
        <li class="nav-pull-down my-shop"><a href="#">我的砍价</a> <span class="glyphicon glyphicon-menu-down"></span></li>
        <div id="user_login">
        </div>

    </ul>
</div>

<!-- 导航条 -->

<div class="shop-nav-box">
    <div class="shop-nav-container">
        <ul>
            <li>
                <a href="#">首页</a>
            </li>

        </ul>
    </div>
</div>

<!-- 商品信息展示 -->
<div id="content">

</div>

<!-- 底部 -->
<footer class="footer">
    <div class="clearfix"></div>
    <div class="icon-row">
        <div class="footer-icon">
            <h5 class="footer-icon-child"></h5>
            <span class="footer-icon-text">品类齐全，轻松购物</span>
        </div>
        <div class="footer-icon">
            <h5 class="footer-icon-child footer-icon-child-2"></h5>
            <span class="footer-icon-text">多仓直发，极速配送</span>
        </div>
        <div class="footer-icon">
            <h5 class="footer-icon-child footer-icon-child-3"></h5>
            <span class="footer-icon-text">正品行货，精致服务</span>
        </div>
        <div class="footer-icon">
            <h5 class="footer-icon-child footer-icon-child-4"></h5>
            <span class="footer-icon-text">天天低价，畅选无忧</span>
        </div>
    </div>
    <div class="service-intro">
        <div class="servece-type">
            <div class="servece-type-info">
                <ul>
                    <li>购物指南</li>
                    <li>购物流程</li>
                    <li>会员介绍</li>
                    <li>生活旅行</li>
                    <li>常见问题</li>
                    <li>大家电</li>
                    <li>联系客服</li>
                </ul>
            </div>
            <div class="servece-type-info">
                <ul>
                    <li>配送方式</li>
                    <li>上门自提</li>
                    <li>211限时达</li>
                    <li>配送服务查询</li>
                    <li>配送费收取标准</li>
                    <li>海外配送</li>
                </ul>
            </div>
            <div class="servece-type-info">
                <ul>
                    <li>支付方式</li>
                    <li>货到付款</li>
                    <li>在线支付</li>
                    <li>分期付款</li>
                    <li>邮局汇款</li>
                    <li>公司转账</li>
                </ul>
            </div>
            <div class="servece-type-info">
                <ul>
                    <li>售后服务</li>
                    <li>售后政策</li>
                    <li>价格保护</li>
                    <li>退款说明</li>
                    <li>返修/退换货</li>
                    <li>取消订单</li>
                </ul>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="friend-link">
            <div class="friend-link-item">
                <ul>
                    <li><span class="link-item">关于我们</span></li>
                    <li><span class="link-item">联系我们</span></li>
                    <li><span class="link-item">联系客服</span></li>
                    <li><span class="link-item">合作招商</span></li>
                    <li><span class="link-item">商家帮助</span></li>
                    <li><span class="link-item">营销中心</span></li>
                    <li><span class="link-item">销售联盟</span></li>
                    <li><span class="link-item">校园社区</span></li>
                    <li><span class="link-item">风险监测</span></li>
                    <li><span class="link-item link-last-item">隐私政策</span></li>
                </ul>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="copyright">
            <p>Copyright © 2017 BY 咪咪商城</p>
        </div>
    </div>
</footer>
</body>
<script type="text/javascript">
    $('.item-detail-img-small img').hover(function () {
        $('.item-detail-big-img img').attr('src', $(this).attr('src'));
    });
</script>

<script>

    var item = []
    jQuery(document).ready(function () {
        var userid;

        $.ajax({
            type: "GET",
            url: "http://" + g_host + "/user/check",
            data: {
                "token": window.localStorage.getItem("token")
            },
            async:false,
            xhrFields: {withCredentials: true},
            success: function (data) {
                var dom = "";
                if (data.data != null) {
                    dom = "<li class='login-signup'>你好，" + data.data.name + "</li>";
                    user = data.data;
                    userid = data.data.id;

                } else {
                   window.location.href="login.html"
                }
                $("#user_login").append($(dom));

            }
        });

        $.ajax({
            type: "GET",
            url: "http://" + g_host + "/item/getDecrease?userId=" + userid,
            xhrFields: {withCredentials: true},
            async:false,
            success: function (data) {
                item = data.data
                reload();
            }
        });
    })
    function reload() {
        var dom = "";
        let tmp = "";
        for (var i = 0; i < item.length; i++) {
            var now = item[i].itemOriginalPrice - item[i].discount;
            dom +=     "<div class='item-detail-show'>" +
                    "<div class='item-detail-right'>" +

                    "<div class='item-detail-title'>" +
                    "<p>" +item[i].title+"</p>" +
                "</div>" +
                "<div class='item-detail-price-row'>" +
                    "<div class='item-detail-big-img'>"+
                    "<img src='"+item[i].itemImg+"'>"+
                    "</div>" +
                    "<div class='item-price-left'>" +
                    "<div class='item-price-row'>" +
                    "<p><span class='item-price-title'>原价：</span> <span class='item-price'>￥"+item[i].itemOriginalPrice+"</span></p>"+
                "</div>" +
                "<div class='item-price-row'>" +
                    "<p>"+
                    "<span class='item-price-title' style='color: red; font-size: 20px'>砍价</span>" +
                    "<span class='item-discount'>-￥"+item[i].discount+"</span>" +
                    "</p>" +
                    "</div>" +
                    "<div class='item-price-row'>" +
                    "<p>" +
                    "<span class='item-price-title'>现价</span>" +
                    "<span class='item-price'>￥"+now+"</span>"+

                    "</p>"+
                   " </div>"+
                    "</div>"+
                    "</div>"+
                    "</div>"+
            "<div class='item-detail-right2'>" +
            "<div class='item-detail-title2'>" +
            "<p>砍价详情</p>" +
            "</div>" +
            "<div class='item-detail-price-row2'>"

            console.log()
            if (item[i].discountMap.length != 0) {
                for (var key in item[i].discountMap) {
                    tmp +=

                        "<p>" +
                        "<span class='item-price-title'>" + key + "</span>" +

                        "<span class='item-discount'>帮你砍价￥" + item[i].discountMap[key] + "</span>" +

                        "   </p>"

                }
            }
            if (Object.keys(item[i].discountMap).length === 0) {
                tmp +=

                    "<p>" +
                   "暂时没人帮您砍价"

                    "   </p>"
            }

            dom += tmp +              "</div>" +
                "</div>"+"</div>"

            tmp = ""


        }

        $("#content").append(dom);
    }




</script>
</html>