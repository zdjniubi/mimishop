<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>购物车</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/mall.css">
    <link rel="stylesheet" href="css/car/base.css">
    <link rel="stylesheet" href="css/car/top.css">
    <link rel="stylesheet" href="css/car/w.css">
    <link rel="stylesheet" href="css/car/bar.css">
    <link rel="stylesheet" href="css/car/item-list.css">
    <link rel="stylesheet" href="css/car/settlement.css">
    <link rel="stylesheet" href="css/car/bottom.css">
    <script type="text/javascript" src="js/dropdown.js"></script>

	<script src="./gethost.js" type="text/javascript"></script>
    <style>
        body {
            background-color: #fff;
        }
    </style>
</head>
<body>
<!-- 顶部导航条 -->
<div class="nav">
    <ul>
        <li class="nav-pull-down location">
            <img src="img/icon_location.png"> 送至珠海
        </li>
        <li>
            <a href="#">手机商城</a>
        </li>
        <li>
            <a href="#">网站导航</a>
        </li>
        <li>
            <a href="help.html">客户服务</a>
        </li>
        <li>
            <a href="#">企业采购</a>
        </li>
        <li>
            <a href="index.html">首页</a>
        </li>
        <li class="nav-pull-down my-shop"><a href="kill_detail.html">我的砍价</a> <span class="glyphicon glyphicon-menu-down"></span></li>
        <li class="nav-pull-down my-shop"><a href="order.html">我的订单</a> <span class="glyphicon glyphicon-menu-down"></span></li>
        <div id="user_login">
        </div>
    </ul>
</div>
<!-- 导航条 -->
<!-- 导航栏 -->


<div class="bar">
    <div class="t-checkbox">
        <div class="cart-checkbox">
            <input type="checkbox" id="allchecked" onclick="setAll()">
            <label for></label>
        </div>
        全选
    </div>
    <div class="t-goods">商品</div>
    <div class="t-shop">商家</div>
    <div class="t-price">单价</div>
    <div class="t-quantity">数量</div>
    <div class="t-sum">小计</div>
    <div class="t-action">操作</div>
</div>

<div class="item-list" id="item-list">



</div>

<div class="settlement">
    <div class="ww">
        <div id="calculate">结算</div>
        <div class="price-sum">
            总价：￥<span class="sum-price"></span>
        </div>
    </div>

    <div class="submit">
        <a href="javascript:void(0)" id="submit-order">提交订单</a>
    </div>
</div>

<div class="bottom">
    <div class="link">
        <a href="order.html">查看已完成的订单</a>
    </div>
</div>


<!-- 底部 -->
<footer class="footer">
    <div class="clearfix"></div>
    <div class="icon-row">
        <div class="footer-icon">
            <h5 class="footer-icon-child"></h5>
            <span class="footer-icon-text">品类齐全，轻松购物</span>
        </div>

        <div class="footer-icon">
            <h5 class="footer-icon-child footer-icon-child-2"></h5>
            <span class="footer-icon-text">多仓直发，极速配送</span>
        </div>
        <div class="footer-icon">
            <h5 class="footer-icon-child footer-icon-child-3"></h5>
            <span class="footer-icon-text">正品行货，精致服务</span>
        </div>
        <div class="footer-icon">
            <h5 class="footer-icon-child footer-icon-child-4"></h5>
            <span class="footer-icon-text">天天低价，畅选无忧</span>
        </div>
    </div>
    <div class="service-intro">
        <div class="servece-type">
            <div class="servece-type-info">
                <ul>
                    <li>购物指南</li>
                    <li>购物流程</li>
                    <li>会员介绍</li>
                    <li>生活旅行</li>
                    <li>常见问题</li>
                    <li>大家电</li>
                    <li>联系客服</li>
                </ul>
            </div>
            <div class="servece-type-info">
                <ul>
                    <li>配送方式</li>
                    <li>上门自提</li>
                    <li>211限时达</li>
                    <li>配送服务查询</li>
                    <li>配送费收取标准</li>
                    <li>海外配送</li>
                </ul>
            </div>
            <div class="servece-type-info">
                <ul>
                    <li>支付方式</li>
                    <li>货到付款</li>
                    <li>在线支付</li>
                    <li>分期付款</li>
                    <li>邮局汇款</li>
                    <li>公司转账</li>
                </ul>
            </div>
            <div class="servece-type-info">
                <ul>
                    <li>售后服务</li>
                    <li>售后政策</li>
                    <li>价格保护</li>
                    <li>退款说明</li>
                    <li>返修/退换货</li>
                    <li>取消订单</li>
                </ul>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="friend-link">
            <div class="friend-link-item">
                <ul>
                    <li><span class="link-item">关于我们</span></li>
                    <li><span class="link-item">联系我们</span></li>
                    <li><span class="link-item">联系客服</span></li>
                    <li><span class="link-item">合作招商</span></li>
                    <li><span class="link-item">商家帮助</span></li>
                    <li><span class="link-item">营销中心</span></li>
                    <li><span class="link-item">销售联盟</span></li>
                    <li><span class="link-item">校园社区</span></li>
                    <li><span class="link-item">风险监测</span></li>
                    <li><span class="link-item link-last-item">隐私政策</span></li>
                </ul>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="copyright">
            <p>Copyright © 2017 BY Gavin 咪咪商城</p>
        </div>
    </div>
</footer>
</body>
<script>
	// // 第一步：匹配加载的页面中是否含有js
	// function executeScript(html){
	// 	reg = /<script[^>]*>([^\x00]+)$/i;
	// 	//对整段HTML片段按<\/script>拆分
	// 	htmlBlock = html.split("<\/script>");
	// 	for (i in htmlBlock){
	// 		blocks;//匹配正则表达式的内容数组，blocks[1]就是真正的一段脚本内容，因为前面reg定义我们用了括号进行了捕获分组
	// 		if (blocks = htmlBlock[i].match(reg)){
	// 			//清除可能存在的注释标记，对于注释结尾-->可以忽略处理，eval一样能正常工作
	// 			code = blocks[1].replace(/<!--/, '');
	// 			try{
	// 				eval(code) //执行脚本
	// 			}
	// 			catch(e){}
	// 		}
	// 	}
	// }
	var car_list = [];
	jQuery(document).ready(function(){
		var token = window.localStorage["token"];

			$.ajax({
				type:"GET",
				contentType:"application/x-www-form-urlencoded",
				url:"http://"+g_host+"/car/getRecord",
				data:{
					"token":token
				},
				xhrFields:{withCredentials:true},
                async : false,
				success:function(data){
					if(data.status == "success"){
						console.log("carRecord get success!");
						car_list = data.data;
						reload();
					} else if (data.status == "un_login"){

						console.log("carRecord get failure!");
						window.location.href="login.html";
					} else {
						console.log("carRecord get failure!");
					}
				},
			});
        $(".deleteItem").click(function () {
            var code = $(this).attr("code");
            console.log(code);
            $.ajax({
                type:"GET",
                contentType:"application/x-www-form-urlencoded",
                url:"http://"+g_host+"/car/delete",
                data:{
                    "token":token,
                    "carId": code
                },
                xhrFields:{withCredentials:true},
                success:function(data){
                    if(data.status == "success") {
                    }
                },
            });
        })
	});
	function reload() {
		var dom = "";
		if (car_list.length == 0) {
		    alert("购物车未加入任何商品...")
        }
		for (var i = 0; i < car_list.length; i++) {
			console.log(car_list[i])

			dom += "<div class='item'>" +
					"<div class='p-checkbox'>" +
					"<input type='checkbox' name='p-radio'><label for></label> " +
					"</div>"+

			"<div class='p-goods'>"+
					"<div class='p-img'><img src='"+car_list[i].imgUrl+"'></div>"+
					"<div class='p-name'>"+ car_list[i].title+"</div>" +
			"</div>"+
					"<div class='p-shop'>mimi商城</div>" +
					"<div class='p-price'>￥<span class='onlyPrice'>"+car_list[i].price+"</span></div>" +

			"<div class='p-quantity'>" +
					"<input type='button' class='decrease' value='-'>" +
					"<input type='text' class='quantity' value="+car_list[i].count+">" +
					"<input type='button' class='increase' value='+'>" +
			"</div>"+
					"<div class='p-sum'>￥<span class='onlySum'>"+car_list[i].price+"</span></div>"+

			"<div class='p-action'>" +
					"<input type='button' class='deleteItem' value='删除' code ='"+car_list[i].id+"'/>" +
					"</div>"+
			"</div>"
		}
		$(".item-list").append($(dom));

	}



</script>
<script src="js/checkUser.js"></script>
</html>